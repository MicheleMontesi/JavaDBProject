\documentclass[a4paper, 12pt]{report}

% Packages
\usepackage{alltt, fancyvrb, url}
\usepackage{graphicx}
\usepackage[margin=2cm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage{float}
\usepackage{hyperref}
\usepackage{multicol}
\usepackage{xurl}
\usepackage{lipsum}
\usepackage[htt]{hyphenat}
\usepackage{tabularx}
\usepackage{array}
\usepackage{color}
\usepackage{colortbl}
\usepackage[table]{xcolor}
\usepackage{numprint}
\usepackage{listings, lstautogobble}
\usepackage{textcomp}
\usepackage[font={small,it}]{caption}
\usepackage[normalem]{ulem}

% Language Package
\usepackage[italian]{babel}
\usepackage[italian]{cleveref}
\usepackage[toc,page]{appendix}

% Definition of environments and colors
\definecolor{seaGreen}{cmyk}{0.19, 0, 0.25, 0.00}

\definecolor{yellowCanary}{cmyk}{0, 0.13, 0.45, 0}

\newenvironment{sloppypar*}{\sloppy\ignorespaces}{\par}

% START MYSQL CODE FORMATTING

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{HTML}{C42043}
\definecolor{backcolour}{HTML}{F2F2F2}
\definecolor{bookColor}{cmyk}{0,0,0,0.90}  
\color{bookColor}

\lstset{
        language=SQL,
        deletekeywords={IDENTITY},
        deletekeywords={[2]INT},
        morekeywords={clustered},
        framesep=8pt,
        xleftmargin=40pt,
        framexleftmargin=40pt,
        frame=tb,
        framerule=0pt
}

\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
    commentstyle=\color{codegreen},
    keywordstyle=\color{codepurple},
    numberstyle=\numberstyle,
    stringstyle=\color{codepurple},
    basicstyle=\footnotesize\ttfamily,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=10pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
}
\lstset{style=mystyle}

\newcommand\numberstyle[1]{%
    \footnotesize
    \color{codegray}%
    \ttfamily
    \ifnum#1<10 0\fi#1 |%
}

% END MYSQL CODE FORMATTING

\newenvironment{changemargin}[2]{%
  \begin{list}{}{%
    \setlength{\topsep}{0pt}%
    \setlength{\leftmargin}{#1}%
    \setlength{\rightmargin}{#2}%
    \setlength{\listparindent}{\parindent}%
    \setlength{\itemindent}{\parindent}%
    \setlength{\parsep}{\parskip}%
  }%
  \item[]}{\end{list}}

\newenvironment{packed_enum}{
\begin{enumerate}
        \setlength{\itemsep}{1pt}
        \setlength{\parskip}{0pt}
        \setlength{\parsep}{0pt}
}{\end{enumerate}}

\newenvironment{packed_itemize}{
\begin{itemize}
        \setlength{\itemsep}{1pt}
        \setlength{\parskip}{0pt}
        \setlength{\parsep}{0pt}
}{\end{itemize}}

% Initialization
\title{Relazione Progetto Basi di Dati 2022}
\author{Michele Montesi \\
        Matricola: 0000974934 \\
        E-Mail: michele.montesi3@studio.unibo.it}

\date{\today}

% Begin
\begin{document}
    
\maketitle
\tableofcontents

\chapter{Analisi Dei Requisiti}
Si vuole realizzare un database a supporto dell'automatizzazione della gestione di una
comunità la quale gestisce diverse residenze per pazienti psichiatrici.
La base di dati dovrà immagazzinare informazioni relative agli operatori, ai pazienti e
alle varie residenze.

\section{Intervista}
Un primo testo ottenuto dall'intervista è il seguente:

\begin{changemargin}{0.5cm}{0.5cm}
        \noindent
        Si vuole tenere traccia di \textbf{pazienti} e \textbf{dipendenti} memorizzandone le informazioni personali
        quali codice fiscale, nome, cognome, compleanno e sesso.
        Differenziando le due entità si memorizzeranno, inoltre, le informazioni legate alla propria posizione.
        Questi due soggetti possono essere registrati nel sistema solo accettando alcune clausole o
        disponendo di eventuali requisiti.\\
        I \textbf{dipendenti} possono acquisire degli \textbf{attestati} che gli conferiscono crediti ECM e possono firmare
        \textbf{contratti} (prima di firmare un secondo contratto con lo stesso nome, il primo deve essere concluso).
        Di entrambi verrà mantenuto uno storico.\\
        I \textbf{turni} dei dipendenti sono determinati dal codice fiscale del dipendente, il giorno della settimana, 
        l'ora d'inizio, l'ora di fine e l'unità operativa in cui si svolgeranno.\\
        I \textbf{pazienti} sono identificati da una \textbf{cartella clinica} la quale contiene informazioni riguardanti
        l'anamnesi, la diagnosi e il progetto riabilitativo del paziente. A ognuno di questi verrà assegnata una 
        \textbf{terapia} la quale dovrà essere seguita assumendo farmaci (somministrati da dipendenti) e della quale
        verrà mantenuto uno storico.\\
        I \textbf{farmaci} sono caratterizzati dal loro codice, il nome, la casa farmaceutica, le date d'acquisto e
        di scadenza e la quantità.\\
        Sono presenti \textbf{unità operative} (le quali possono essere \texttt{gruppi appartamento} o \texttt{residenze
        sanitarie psichiatriche}) adibite all' \textbf{ospitazione} di più pazienti della quale verrà mantenuto uno storico.
        Queste sono caratterizzate dalla loro ubicazione, i posti letto e il numero dei pazienti.
        Per poter essere operative devono ricevere l'\texttt{autorizzazione al funzionamento} e l'\texttt{accreditamento}.
        Ogni unità operativa avrà una lista di \textbf{beni strumentali}, i quali possono essere automezzi o attrezzature.
\end{changemargin}

\section{Estrazione dei concetti principali}\label{sec:estrazione-dei-concetti-principali}
\begin{tabularx}{\textwidth}{lXc}
        \rowcolor{seaGreen}
        \textbf{Termine} & \textbf{Breve descrizione} & \textbf{Eventuali sinonimi} \\
        Dipendente & Colui che è assunto dalla società e lavora in una o più strutture a seconda dei turni e
        somministra farmaci ai pazienti.\ Può essere socio.\ & Lavoratore \\
        \hline
        Contratto & Oggetto contenente le ore lavorative mensili del dipendente a cui viene sottoscritto.\ & Contratto Lavorativo \\
        \hline
        Attestato & Oggetto che conferisce, al dipendente che ne consegue il completamento, crediti EMC (crediti formativi).\ & Formazione \\
        \hline
        Paziente & Colui che riceve le cure attraverso la somministrazione di farmaci, seguendo una terapia, ed è ospitato
        all'interno di una unità operativa.\ & Cliente \\
        \hline
        Cartella clinica & Documentazione del paziente contenente anamnesi, diagnosi e progetto riabilitativo.\ & Cartella \\
        \hline
        Terapia & Oggetto che riporta i farmaci da assumere durante un periodo di tempo.\ & Cura \\
        \hline
        Farmaco & Medicinale adibito all'assunzione da parte di pazienti a cui è stato assegnato.\ & Medicinale \\
        \hline
        Unità operativa & Residenza o appartamento i cui i pazienti risiedono e ricevono le cure da parte del personale.\ & Residenza, Unità \\
        \hline
        Bene strumentale & Strumento o veicolo aziendale necessario o utile a semplificare il lavoro o la permanenza nell'unità operativa.\ & Strumentazione, Veicolo
\end{tabularx} \par
\bigskip \noindent
A seguito della lettura e comprensione dei requisiti, si procede redigendo un testo che ne 
riassuma tutti i concetti e in particolare ne estragga quelli principali eliminando le ambiguità 
sopra rilevate: \par
\smallskip
\begin{changemargin}{0.5cm}{0.5cm}
        \noindent
        Per ogni \textbf{dipendente} vengono memorizzati Codice Fiscale, Nome, Cognome, Compleanno, Residenza, Sesso, Titolo di Studio,
        l'Idoneità alla mansione, se è Socio o meno e i Crediti ECM. Ogni dipendente dispone, inoltre, di un codice univoco fornitogli
        al momento del suo inserimento nel DB. 
        Ogni dipendente può acquisire degli \textbf{attestati} che gli conferiscono crediti ECM e possono firmare
        \textbf{contratti} (prima di firmare un secondo contratto con lo stesso nome, il primo deve essere concluso).
        Di entrambi verrà mantenuto uno storico. Oltre queste due possibili operazioni, ogni dipendente può Somministrare
        eventuali farmaci a i pazienti che ne devono usufruire come da terapia (maggiori informazioni più avanti).\\
        Ogni \textbf{turno} è determinato dal codice fiscale del dipendente, il giorno della settimana, 
        l'ora d'inizio, l'ora di fine e l'unità operativa in cui si svolgerà. Un turno di uno stesso dipendente nello stesso
        giorno della settimana non potrà essere definito se si interseca ad un altro.\\
        Per ogni \textbf{paziente} vengono memorizzati Codice Fiscale, Nome, Cognome, Compleanno, Residenza, Sesso.
        Al momento della registrazione dovrà firmare la documentazione alla privacy, il consenso al trattamento e l'accettazione
        del regolamento. Ognuno possiede una \textbf{cartella clinica} la quale contiene informazioni riguardanti
        l'anamnesi, la diagnosi e il progetto riabilitativo. A ognuno di questi verrà assegnata una 
        \textbf{terapia} la quale dovrà essere seguita assumendo farmaci (somministrati da dipendenti) e della quale
        verrà mantenuto uno storico.\\
        Ogni \textbf{farmaco} è caratterizzato dal proprio codice, utilizzato come chiave, il nome, la casa farmaceutica, 
        la data d'acquisto e di scadenza e la quantità.\\
        Ogni \textbf{unità operativa} può essere \texttt{gruppo appartamento} o \texttt{residenza sanitaria psichiatrica}.
        Ognuna di queste è adibita all' \textbf{ospitazione} di più pazienti (la quale dovrà essere registrata
        con data d'inizio e opzionalmente con una data di fine), della quale verrà mantenuto uno storico.
        Ognuna unità operativa è caratterizzate dall'ubicazione, i posti letto e il numero dei pazienti il quale dev'essere
        minore o uguale al numero di pazienti e non inferiore allo 0.
        Per poter essere operative devono ricevere l'\texttt{autorizzazione al funzionamento} e l'\texttt{accreditamento}.
        Ogni unità operativa avrà una lista di \textbf{beni strumentali}, i quali possono essere \textbf{automezzi} o \textbf{attrezzature}. \\
        Nel caso il bene sia un automezzo viene registrata, oltre ai dati generici del supertipo, la targa, la tipologia (benzina, diesel, ...)
        e la data di scadenza dell'assicurazione. \\
        Nel caso sia, invece, attrezzatura generica, viene registrato il nome dell'attrezzo.
        \newline
\end{changemargin}
Segue un elenco delle principali operazioni richieste:
\begin{packed_enum}
        \item Registrare un nuovo dipendente
        \item Registrare un nuovo paziente
        \item Registrare la somministrazione di un farmaco 
        \item Compilare una nuova cartella clinica 
        \item Assegnare una terapia già esistente ad un paziente
        \item Visualizzare tutti i pazienti con inizio ospitazione in un dato anno
        \item Registrare l'acquisto di beni strumentali
        \item Visualizzare tutti i pazienti con una data terapia
        \item Registrare la stipulazione di un contratto già esistente 
        \item Visualizzare tutti i dipendenti con un contratto specifico
        \item Visualizzare tutti i dipendenti di turno in un giorno della settimana
        \item Registrare un nuovo turno 
        \item Aggiornare un turno già esistente 
\end{packed_enum}

\chapter{Progettazione Concettuale}

\section{Schema scheletro}

% Dipendente e Paziente
\noindent
Le entità di \textbf{dipendente} e \textbf{paziente} sono la generalizzazione di una entità \textbf{persona}, identificata
tramite il codice fiscale. Ogni paziente possiede una terapia la quale gli viene somministrata da un dipendente.
Quando questa viene somministrata, in base alla quantità di farmaci utilizzati, il contatore del farmaco in questione verrà
diminuito di tale dato.

\begin{figure}[H]
        \centering
        \includegraphics[height=5cm]{img/dipendentePazienteERPostReif.png}
        \caption{Schema E/R con le principali entità per modellazione della somministrazione di farmaci}
\end{figure}

\noindent
Dall'analisi del dominio si evince come serva tenere uno storico di tutti i farmaci somministrati
da un dipendente ad un paziente. Perciò si reifica l'associazione tra \textbf{dipendente} e \textbf{terapia} generando
una nuova entità \textbf{farmaco\_terapia} che tiene traccia della quantità del \textbf{farmaco} somministrato, la data, 
il somministratore e la terapia. Questa entità è definita dal suo \textit{codice univoco incrementale}, il \textit{codice della terapia} ed 
il \textit{codice del dipendente}.

\begin{figure}[H]
        \centering
        \includegraphics[height=5cm]{img/dipendentePazienteERPreReif.png}
        \caption{Schema E/R con le principali entità per modellazione della somministrazione di farmaci e del suo storico}
\end{figure}

% Dipendente
\noindent
Un dipendente durante la sua carriera può acquisire \textbf{contratti} e \textbf{attestati}, i quali verranno registrati con le proprie date
di acquisizione ed eventualmente di fine validità.

\begin{figure}[H]
        \centering
        \includegraphics[height=6cm]{img/dipendenteContrattiPreReif.png}
        \caption{Schema E/R rappresentante il sistema di contratti e attestati per i dipendenti}
\end{figure}

\noindent
Poiché ogni dipendente può firmare più di un contratto e può acquisire più di un attestato non è sufficiente un'associazione.
Viene, quindi, eseguita la reificazione delle due associazioni interessate creando due nuove entità, grazie alle quali sarà possibile
mantenere uno storico degli \textbf{attestati acquisiti} e dei \textbf{contratti stipulati}, potendone registrare più di uno per dipendente.

\begin{figure}[H]
        \centering
        \includegraphics[height=8cm]{img/dipendenteContrattiPostReif.png}
        \caption{Schema E/R rappresentante il sistema di contratti e attestati per i dipendenti e la loro storicizzazione}
\end{figure}

\noindent
Ogni paziente possiede una tabella rappresentante i propri turni dal lunedì alla domenica. Ogni turno è identificato dall'unità operativa
in cui verrà svolto, dal giorno della settimana, l'ora d'inizio e dal dipendente da cui verrà svolto.
\begin{figure}[H]
        \centering
        \includegraphics[height=4cm]{img/dipendenteTurniPreReif.png}
        \caption{Schema E/R rappresentante il sistema di turni per ogni paziente}
\end{figure}

\noindent
Poiché ogni dipendente può svolgere più di un turno è stato necessario operare una reificazione dell'associazione tra dipendente
e unità operativa. In questo modo si potrà tenere più di un turno per ogni dipendente, a patto che questi non siano in sovrapposizione.

\begin{figure}[H]
        \centering
        \includegraphics[height=3.5cm]{img/dipendenteTurniPostReif.png}
        \caption{Schema E/R rappresentante il sistema di turni per ogni paziente e la tabella dei turni}
\end{figure}

% Paziente
\noindent
Un paziente può essere ospitato in un'\textbf{unità operativa}. Nelle informazioni che vanno registrate al momento dell'inserimento è presente
la data d'inizio permanenza e opzionalmente la data di fine.

\begin{figure}[H]
        \centering
        \includegraphics[height=4cm]{img/pazienteOspitazionePreReif.png}
        \caption{Schema E/R rappresentante il sistema di ospitazione dei pazienti nelle unità operative}
\end{figure}

\noindent
Poiché ogni paziente può essere ospitato in più unità operative in diversi periodi di tempo, è necessario operare la reificazione
dell'associazione tra paziente e unità operativa. Così facendo sarà possibile mantenere uno storico di tutte le \textbf{ospitazioni},
potendone inserire più di una per paziente.

\begin{figure}[H]
        \centering
        \includegraphics[height=3cm]{img/pazienteOspitazionePostReif.png}
        \caption{Schema E/R rappresentante il sistema di ospitazione dei pazienti nelle unità operative e la loro storicizzazione}
\end{figure}

\noindent
Ogni paziente è identificato da una, ed una soltanto, \textbf{cartella clinica}, per cui è stata sufficiente e necessaria un'associazione
1-1 tra i due soggetti interessati. In ogni cartella clinica sono presenti informazioni personali per ogni paziente quali l'\textit{anamnesi},
la \textit{diagnosi} e il proprio \textit{progetto riabilitativo}. 

\begin{figure}[H]
        \centering
        \includegraphics[height=3cm]{img/pazienteCartella.png}
        \caption{Schema E/R rappresentante la relazione tra paziente e cartella clinica}
\end{figure}

% Unità Operativa
\noindent
Ogni unità operativa possiede diversi \textbf{beni strumentali} i quali possono essere \textbf{attrezzature} oppure \textbf{automezzi}.
Ogni bene strumentale appartiene ad una, ed una soltanto, unità operativa. Le entità \texttt{attrezzatura} e \texttt{automezzi} sono una generalizzazione
dell'entità \texttt{beni\_strumentali}. Nel caso di \texttt{attrezzatura} verrà registrato, oltre alle informazioni del supertipo, il nome dell'attrezzo.
Nel caso di \texttt{automezzi} verrà registrata, invece, la targa, la tipologia di veicolo e la scadenza della sua assicurazione.

\begin{figure}[H]
        \centering
        \includegraphics[height=10cm]{img/unitàOperativaBeni.png}
        \caption{Schema E/R rappresentante la relazione tra unità operativa e beni strumentali}
\end{figure}

\section{Schema finale}

\begin{figure}[H]
        \centering
        \includegraphics[width=1.0\textwidth]{img/ERFinaleSX.png}
\end{figure}

\begin{figure}[H]
        \centering
        \includegraphics[width=1.0\textwidth]{img/ERFinaleDX.png}
\end{figure}

\chapter{Progettazione Logica}

\section{Stima del volume dei dati}

\begin{changemargin}{-1cm}{-1cm}
        \begin{multicols}{2}
                \renewcommand{\arraystretch}{1.2}
                \begin{tabularx}{8.5cm}{lXc}
                        \rowcolor{seaGreen}
                        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Volume} \\
                        Dipendente & E & 500 \\
                        \hline
                        Assegnare & R & 10000 \\
                        \hline
                        Turno & E & 10000 \\
                        \hline
                        Svolgere & R & 10000 \\
                        \hline
                        Unità Operativa & E & 50 \\
                        \hline
                        \vspace{\baselineskip} \\
                        \hline
                        Tipologia Attestato & E & 50 \\
                        \hline
                        Acquisizione & R & 2500 \\
                        \hline
                        Attestato Acquisito & E & 2500 \\
                        \hline
                        Conseguire & R & 2500 \\
                        \hline
                        \vspace{\baselineskip} \\
                        \hline
                        Tipologia Contratto & E & 20 \\
                        \hline
                        Stipulare & R & 1000 \\
                        \hline
                        Contratto Stipulato & E & 1000 \\
                        \hline
                        Firmare & R & 1000 \\
                        \hline
                        \vspace{\baselineskip} \\
                        \hline
                        Paziente & E & 2000 \\
                        \hline
                        Identificare & R & 2000 \\
                        \hline
                        Cartella Clinica & E & 2000 \\
                        \hline
                        \vspace{\baselineskip} \\
                        \hline
                        Terapia & E & 1500 \\
                        \hline
                        Assumere Terapia & R & 2000 \\
                        \hline
                        Definire & R & 1000 \\
                        \hline
                        Farmaco Terapia & E & 10000 \\
                        \hline
                        Somministrare & R & 10000 \\
                        \hline
                        Consumare & R & 10000 \\
                        \hline
                        Farmaco & E & 1000 \\
                        \hline
                \end{tabularx}

                \begin{tabularx}{8.5cm}{lXc}
                        \rowcolor{seaGreen}
                        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Volume} \\
                        Ospitare & R & 8000 \\
                        \hline
                        Ospitazione & E & 8000 \\
                        \hline
                        Fornire & R & 8000 \\
                        \hline
                        Possedere & R & 5000 \\
                        \hline
                        Beni Strumentali & E & 5000 \\
                        \hline
                \end{tabularx}
        \end{multicols}
\end{changemargin}

\section{Descrizione delle operazioni principali e stima della loro frequenza}

\renewcommand{\arraystretch}{1.2}
\begin{tabularx}{\textwidth}{cXl}
        \rowcolor{seaGreen}
        \textbf{Codice} & \textbf{Operazione} & \textbf{Frequenza} \\
        1 & Registrare un nuovo dipendente & 10 all'anno \\
        \hline
        2 & Registrare un nuovo paziente & 5 al mese \\
        \hline
        3 & Registrare la somministrazione di un farmaco & 2000 al giorno \\
        \hline
        4 & Compilare una nuova cartella clinica & 5 al mese \\
        \hline
        5 & Assegnare una terapia già esistente ad un paziente & 5 al mese \\
        \hline
        6 & Visualizzare tutti i pazienti con inizio ospitazione in un dato anno & 20 al mese \\
        \hline
        7 & Registrare l'acquisto di beni strumentali & 10 al mese \\
        \hline
        8 & Visualizzare tutti i pazienti con una data terapia & 10 al giorno \\
        \hline
        9 & Registrare la stipulazione di un contratto già esistente & 10 all'anno \\
        \hline
        10 & Visualizzare tutti i dipendenti con un contratto specifico & 10 al mese \\
        \hline
        11 & Visualizzare tutti i dipendenti di turno in un giorno della settimana & 1 al giorno \\
        \hline
        12 & Registrare un nuovo turno & 1 al mese \\
        \hline
        13 & Aggiornare un turno già esistente & 10 al mese \\
        \hline
\end{tabularx}

\section{Schemi di navigazione e tabelle degli accessi}
Sono riportate in seguito le tabelle degli accessi delle operazioni sopra riportate; inoltre, ove
non risulti banale, sono stati inseriti i relativi schemi di navigazione. Al fine del calcolo dei
costi, si considerano di peso doppio gli accessi in scrittura rispetto a quelli in lettura.

\subsubsection*{OP 1 - Registrare un nuovo dipendente}
\renewcommand{\arraystretch}{1.2}
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Dipendente & E & 1 & S \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 1S $\rightarrow$ 10 all'anno & \\
\end{tabularx}

\subsubsection*{OP 2 - Registrare un nuovo paziente}
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Paziente & E & 1 & S \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 1S $\rightarrow$ 5 al mese & \\
\end{tabularx}

\subsubsection*{OP 3 - Registrare la somministrazione di un farmaco}
Prima di permettere la somministrazione di un farmaco, questo deve esserci in quantità sufficiente.
Questo comporterà di dover leggere la quantità del farmaco in questione. \\
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Farmaco & E & 1 & L \\
        \hline
        Consumare & R & 1 & L \\
        \hline
        Farmaco Terapia & E & 1 & S \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 1S + 2L $\rightarrow$ 2000 al giorno & \\
\end{tabularx}

\subsubsection*{OP 4 - Compilare una nuova cartella clinica}
Prima di permettere la creazione di una cartella clinica, bisogna controllare che il paziente esista.
Questo comporterà di dover leggere la lista dei pazienti. \par
\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Paziente & E & 1 & L \\
        \hline
        Identificare & R & 1 & S \\
        \hline
        Cartella Clinica & E & 1 & S \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 2S + 1L $\rightarrow$ 5 al mese & \\
\end{tabularx}

\subsubsection*{OP 5 - Assegnare una terapia già esistente ad un paziente}
Prima di permettere l'assegnamento della terapia ad un paziente, bisogna controllare che questi due esistano.
Sarà quindi necessario andare a leggere sia il paziente che la terapia. \par
\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Paziente & E & 1 & L \\
        \hline
        Terapia & E & 1 & L \\
        \hline
        Assumere Terapia & R & 1 & S \\
        \hline
        Paziente & E & 1 & S \\
        \hline
        Terapia & E & 1 & S \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 3S + 2L $\rightarrow$ 5 al mese & \\
\end{tabularx}

\subsubsection*{OP 6 - Visualizzare tutti i pazienti con inizio ospitazione in un dato anno}
Per visualizzare questa lista occorre leggere tutte le ospitazioni, e nel caso corrisponda con il criterio di ricerca,
leggere anche il paziente in questione. \par 
\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Ospitazione & E & \numprint{8000} & L \\
        \hline
        Ospitare & R & \numprint{8000} & L \\
        \hline
        Paziente & E & \numprint{2000} & L \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: \numprint{18000}L $\rightarrow$ 20 al mese & \\
\end{tabularx}

\subsubsection*{OP 7 - Registrare l'acquisto di beni strumentali}
Prima di permettere l'inserimento di un nuovo bene strumentale, bisogna controllare che l'unità operativa a
cui lo si assegna esista. Sarà quindi necessario leggere l'unità operativa. \par
\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Unità Operativa & E & 1 & L \\
        \hline
        Possedere & R & 1 & S \\
        \hline
        Beni Strumentali & E & 1 & S \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 2S + 1L $\rightarrow$ 10 al mese & \\
\end{tabularx}

\subsubsection*{OP 8 - Visualizzare tutte le unità operativa con tutti i posti letto occupati}
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Unità Operativa & E & 50 & L \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 1L $\rightarrow$ 10 al giorno & \\
\end{tabularx}

\subsubsection*{OP 9 - Registrare la stipulazione di un contratto già esistente}
Prima di stipulare un contratto, bisogna controllare che questo ed il dipendente esistano. 
Si dovrà quindi leggere Tipologia Contratto e Dipendente. \par

\begin{figure}[H]
        \centering
        \includegraphics[height=10cm]{img/OP9SchemaNavigazione.png}
        \caption{Schema Navigazione rappresentante l'analisi di esistenza del dipendente e del contratto}
\end{figure}

\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Tipologia Contratto & E & 1 & L \\
        \hline
        Stipulare & R & 1 & S \\
        \hline
        Contratto Stipulato & E & 1 & S \\
        \hline
        Firmare & R & 1 & S \\
        \hline
        Dipendente & E & 1 & L \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 3S + 2L $\rightarrow$ 10 all'anno & \\
\end{tabularx}

\subsubsection*{OP 10 - Visualizzare tutti i dipendenti con un contratto specifico}
Per visualizzare questa lista occorre leggere tutti i contratti stipulati, e nel caso il contratto corrisponda con il criterio di ricerca,
leggere anche il dipendente in questione. \par 
\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Contratto Stipulato & E & \numprint{1000} & L \\
        \hline
        Firmare & R & \numprint{1000} & L \\
        \hline
        Dipendente & E & \numprint{500} & L \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: \numprint{2500}L $\rightarrow$ 10 al mese & \\
\end{tabularx}

\subsubsection*{OP 11 - Visualizzare tutti i dipendenti di turno in un giorno della settimana}
Per visualizzare questa lista occorre leggere tutti i dipendenti e tutti i turni legati a questi. \par 
\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Dipendente & E & \numprint{500} & L \\
        \hline
        Assegnare & R & \numprint{10000} & L \\
        \hline
        Turno & E & \numprint{10000} & L \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: \numprint{20500}L $\rightarrow$ 1 al giorno & \\
\end{tabularx}

\subsubsection*{OP 12 - Registrare un nuovo turno}
Prima di poter registrare un nuovo turno, bisogna controllare che l'unità operativa in cui si svolgerà
e il dipendente interessato, esistano. Si leggerà quindi il dipendente e l'unità operativa. \par
\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Unità Operativa & E & 1 & L \\
        \hline
        Dipendente & E & 1 & L \\
        \hline
        Turno & E & 1 & S \\
        \hline
        Assegnare & R & 1 & S \\
        \hline
        Svolgere & R & 1 & S \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 3S + 2L $\rightarrow$ 1 al mese & \\
\end{tabularx}

\subsubsection*{OP 13 - Aggiornare un turno già esistente}
Prima di poter aggiornare un turno già esistente, bisogna controllare che questo esista. Si andrà quindi a
leggere il turno e poi a scriverlo. \par
\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Turno & E & 1 & L \\
        \hline
        Turno & E & 1 & S \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 3S + 2L $\rightarrow$ 10 al mese & \\
\end{tabularx}

\newpage
\section{Raffinamento dello schema}
\subsubsection*{Eliminazione delle gerarchie}
Per l'eliminazione della gerarchia \texttt{Persona} si è scelto di adottare l'approccio del collasso verso il basso,
replicando così gli attributi in \texttt{Dipendente} e \texttt{Paziente}. Si è adottata questa soluzione in quanto si deve interagire
con i pazienti e con i dipendenti molto spesso e non si ha la necessità che l'identificatore per tali entità sia globalmente
univoco. \par
\noindent
Per l'eliminazione della gerarchia \texttt{Beni Strumentali} si è scelto, invece, di adottare l'approccio del collasso verso l'alto,
collassando, così, gli attributi di \texttt{Attrezzatura} e di \texttt{Automezzi} in Beni Strumentali. Si è adottata questa soluzione
in quanto si deve interagire con attrezzatura e automezzi poco spesso, per cui è comodo che l'identificatore sia univoco. 

\subsubsection*{Scelta delle chiavi primarie}
Nello schema sono già evidenziate senza ambiguità tutte le chiavi primarie per la maggior parte delle entità. Per quanto riguarda
Dipendente e Paziente verrà usato il codice fiscale.

\subsubsection*{Eliminazione degli identificatori esterni}
Nello schema E/R sono eliminate le seguenti relazioni:
\begin{packed_itemize}
        \item \texttt{Acquisizione}, importando Nome in Attestato\_Acquisito
        \item \texttt{Conseguire}, importando CodiceFiscale (del dipendente) in Attestato\_Acquisito
        \item \texttt{Stipulare}, importando Nome in Contratto\_Stipulato
        \item \texttt{Firmare}, importando CodiceFiscale (del dipendente) in Contratto\_Stipulato
        \item \texttt{Assegnare}, importando CodiceFiscale (del dipendente) in Turno
        \item \texttt{Svolgere}, importando CodiceUnità in Turno
        \item \texttt{Possedere}, importando CodiceUnità in Beni\_Strumentali
        \item \texttt{Fornire}, importando CodiceUnità in Ospitazione
        \item \texttt{Ospitare}, importando CodiceFiscale (del paziente) in Ospitazione
        \item \texttt{Identificare}, importando CodiceFiscale (del paziente) in Cartella\_Clinica
        \item \texttt{Assumere\_Terapia}, reificata importando CodiceFiscale da Paziente e CodiceTerapia da Terapia
        \item \texttt{Definire}, importando CodiceTerapia in Farmaco\_Terapia
        \item \texttt{Somministrare}, importando CodiceFiscale (del dipendente) in Farmaco\_Terapia
        \item \texttt{Consumare}, importando CodFarmaco in Farmaco\_Terapia
\end{packed_itemize}

\newpage
\section{Analisi delle ridondanze}
È stata inserita una ridondanza tramite l'inserimento di un attributo NumeroPazienti in Unità Operativa, così da ridurre gli accessi
nel momento in cui questa informazione venga richiesta.

\subsubsection*{OP 8 - Visualizzare tutte le unità operativa con tutti i posti letto occupati}
L'avere una ridondanza in questo caso aiuta nella verifica del requisito: infatti, per controllare che tutti i posti letto siano occupati
in un'unità operativa basterà comparare l'attributo NumeroPazienti con l'attributo PostiLetto. \par
\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{seaGreen}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Unità Operativa & E & 50 & L \\
        \rowcolor{seaGreen}
         &  & \textbf{Totale}: 50L $\rightarrow$ 10 al giorno & \\
\end{tabularx} \par
\bigskip
\noindent
Senza ridondanza sarebbe invece necessario leggere tutte le ospitazioni relative ad ogni unità operativa, incrementare un contatore
temporaneo ad ogni occorrenza e poi verificare se si è raggiunto il numero massimo di PostiLetto: \par
\bigskip
\noindent
\begin{tabularx}{\textwidth}{XlXl}
        \rowcolor{yellowCanary}
        \textbf{Concetto} & \textbf{Costrutto} & \textbf{Accessi} & \textbf{Tipo} \\
        Unità Operativa & E & 50 & L \\
        \hline
        Fornire & R & 8000 & L \\
        \hline
        Ospitazione & E & 8000 & L \\
        \rowcolor{yellowCanary}
         &  & \textbf{Totale}: \numprint{16050}L $\rightarrow$ 10 al giorno & \\
\end{tabularx}

\newpage
\section{Traduzione di entità e associazioni in relazioni}
\begin{packed_itemize}
        \item \texttt{assumere\_terapia}(\uline{CodiceFiscale}: paziente, \uline{CodiceTerapia}: terapia)
        \item \texttt{attestato\_acquisito}(\uline{CodiceFiscale}: dipendente, \uline{DataAcquisizione}, Nome: tipologia\_attestato)
        \item \texttt{beni\_strumentali}(\uline{CodiceUnità}: unità\_operativa, \uline{CodBene}, DataAcquisto, ProssimaManutenzione, 
                        Automezzo, NomeAttrezzo*, Targa*, Tipologia*, ScadenzaAssicurazione*)
        \item \texttt{cartella\_clinica}(\uline{CodCartellaClinica}, \uline{CodiceFiscale})
        \item \texttt{contratto\_stipulato}(\uline{CodiceFiscale}: dipendente, \uline{DataStipulazione}, DataFine, Nome: tipologia\_contratto)
        \item \texttt{dipendente}(\uline{CodiceFiscale}, Nome, Cognome, Compleanno, Residenza, Sesso, \\\uline{CodiceDipendente}, TitoloDiStudio,
                        IdoneitàAllaMansione, Socio, CreditiECM)
        \item \texttt{farmaco}(\uline{CodFarmaco}, Nome, CasaFarmaceutica, DataAcquisto, DataScadenza, Quantità)
        \item \texttt{farmaco\_terapia}(\uline{CodiceTerapia}: terapia, \uline{CodiceConsumazione}, DataAssunzione, \\Quantità,
                        CodiceFiscale: dipendente, CodFarmaco: farmaco)
        \item \texttt{ospitazione}(\uline{CodiceFiscale}: paziente, \uline{DataInizio}, DataFine*, CodiceUnità: unità\_operativa)
        \item \texttt{paziente}(\uline{CodiceFiscale}, Nome, Cognome, Compleanno, Residenza, Sesso, \\\uline{CodicePaziente}, 
                        DocumentazionePrivacy, ConsensoInformatoAlTrattamento, AccettazioneRegolamento)
        \item \texttt{terapia}(\uline{CodiceTerapia}, DataInizio, Descrizione)
        \item \texttt{tipologia\_attestato}(\uline{Nome}, CreditiECM)
        \item \texttt{tipologia\_contratto}(\uline{Nome}, OreContrattuali)
        \item \texttt{turno}(\uline{CodiceFiscale}: dipendente, \uline{GiornoSettimana}, \uline{OraInizio}, OraFine, CodiceUnità: unità\_operativa)
        \item \texttt{unità\_operativa}(\uline{CodiceUnità}, Tipologia, Denominazione, Ubicazione, PostiLetto, NumeroPazienti, 
                        AutorizzazioneAlFunzionamento, Accreditamento)
\end{packed_itemize}

\section{Schema relazionale finale}
\begin{figure}[H]
        \centering
        \includegraphics[width=1.0\textwidth]{img/schemaRelazionaleSX.png}
\end{figure}

\begin{figure}[H]
        \centering
        \includegraphics[width=1.0\textwidth]{img/schemaRelazionaleDX.png}
\end{figure}
\newpage

\section{Traduzione delle operazioni in query SQL}

\subsubsection*{OP 1 - Registrare un nuovo dipendente}
\begin{lstlisting}[breaklines=true]
INSERT INTO dipendente (CodiceFiscale, Nome, Cognome, Compleanno, Residenza, Sesso, CodiceDipendente, TitoloDiStudio, IdoneitaAllaMansione, Socio, CreditiECM)
VALUES (?,?,?,?,?,?,?,?,?,?,?);
\end{lstlisting}

\subsubsection*{OP 2 - Registrare un nuovo paziente}
\begin{lstlisting}[breaklines=true]
INSERT INTO paziente (CodiceFiscale, Nome, Cognome, Compleanno, Residenza, Sesso, CodicePaziente, DocumentazionePrivacy, ConsensoInformatoAlTrattamento, AccettazioneRegolamento)
VALUES (?,?,?,?,?,?,?,?,?,?);
\end{lstlisting}

\subsubsection*{OP 3 - Registrare la somministrazione di un farmaco}
\begin{lstlisting}[breaklines=true]
INSERT INTO farmacco_terapia (CodiceTerapia, CodiceConsumazione, DataAssunzione, Quantita, CodiceFiscale, CodFarmaco)
VALUES (?,?,?,?,?,?);
\end{lstlisting}

\subsubsection*{OP 4 - Compilare una nuova cartella clinica}
\begin{lstlisting}[breaklines=true]
INSERT INTO cartella_clinica (CodCartellaClinica, CodiceFiscale, Anamnesi, Diagnosi, ProgettoRiabilitativo) 
VALUES (?,?,?,?,?);
\end{lstlisting}

\subsubsection*{OP 5 - Assegnare una terapia già esistente ad un paziente}
\begin{lstlisting}[breaklines=true]
INSERT INTO assumere_terapia (CodiceFiscale, CodiceTerapia)
VALUES (?,?);
\end{lstlisting}

\subsubsection*{OP 6 - Visualizzare tutti i pazienti con inizio ospitazione in un dato anno}
\begin{lstlisting}[breaklines=true]
SELECT *
FROM paziente p LEFT JOIN ospitazione o ON p.CodiceFiscale = o.CodiceFiscale
WHERE YEAR(o.DataInizio) = ?;
\end{lstlisting}

\subsubsection*{OP 7 - Registrare l'acquisto di beni strumentali}
\begin{lstlisting}[breaklines=true]
INSERT INTO beni_sturmentali (CodiceUnita, CodBene, DataAcquisto, ProssimaManutenzione, Automezzo, NomeAttrezzo, Targa, Tipologia, ScadenzaAssicurazione)
VALUES (?,?,?,?,?,?,?,?,?);
\end{lstlisting}

\subsubsection*{OP 8 - Visualizzare tutte le unità operativa con tutti i posti letto occupati}
\begin{lstlisting}[breaklines=true]
SELECT *
FROM unita_operativa
WHERE PostiLetto = NumeroPazienti;
\end{lstlisting}

\subsubsection*{OP 9 - Registrare la stipulazione di un contratto già esistente}
\begin{lstlisting}[breaklines=true]
INSERT INTO contratto_stipulato (CodiceFiscale, DataStipulazione, DataFine, Nome)
VALUES (?,?,?,?);
\end{lstlisting}

\subsubsection*{OP 10 - Visualizzare tutti i dipendenti con un contratto specifico}
\begin{lstlisting}[breaklines=true]
SELECT *
FROM dipendente d LEFT JOIN contratto_stipulato cs ON d.CodiceFiscale = cs.CodiceFiscale
WHERE cs.Nome = ?;
\end{lstlisting}

\subsubsection*{OP 11 - Visualizzare tutti i dipendenti di turno in un giorno della settimana}
\begin{lstlisting}[breaklines=true]
SELECT *
FROM dipendente d LEFT JOIN turno t ON d.CodiceFiscale = t.CodiceFiscale
WHERE t.GiornoSettimana = ?;
\end{lstlisting}

\subsubsection*{OP 12 - Registrare un nuovo turno}
\begin{lstlisting}[breaklines=true]
INSERT INTO turno (CodiceFiscale, GiornoSettimana, OraInizio, OraFine, CodiceUnita) 
VALUES (?,?,?,?,?);
\end{lstlisting}

\subsubsection*{OP 13 - Aggiornare un turno già esistente}
\begin{lstlisting}[breaklines=true]
UPDATE turno 
SET OraFine = ? 
WHERE CodiceFiscale = ? AND OraInizio = ? AND CodiceUnita = ? AND GiornoSettimana = ?;
\end{lstlisting}

\chapter{Progettazione dell’applicazione}

\section{Descrizione dell’architettura dell’applicazione realizzata}
L'applicazione per interfacciarsi al database è stata realizzata in Java. Il database risiede in locale e il DBMS usato è MySQL.
L'applicazione utilizza JavaFX come ambiente grafico e utilizza diversi file FXML (uno per ogni finestra) associati ognuno
al proprio controller il quale ha il compito di portare a termine le query appoggiandosi alla classe ConnectionProvider, la 
quale fornisce la connessione al database.

\begin{figure}[H]
        \centering
        \includegraphics[height=10cm]{img/schermataPrincipaleApp.png}
        \caption{Schermata principale dell'applicazione, nell'esempio è stata selezionata l'entità Dipendente 
        con la propria operazione di aggiunta}
\end{figure}
\noindent
La correttezza dei dati viene controllata dal controller della scheda attualmente aperta, il quale in caso di errore dei dati
restituirà un errore sotto forma di pop-up. Nel caso nessun errore venga mostrato, l'operazione si può considerare
andata a buon fine.
\newpage
\noindent
Nel caso di aggiornamenti, ricerche per parametro e inserimenti di record dipendenti da foreign key, per evitare ulteriori controlli 
da parte del programma, è stato inserito un menù a tendina per i campi già presenti.

\begin{figure}[H]
        \centering
        \includegraphics[height=10cm]{img/schermataAggiornaApp.png}
        \caption{Schermata di aggiornamento di un dipendente}
\end{figure}
\noindent
Una volta selezionato la chiave desiderata, il resto dei campi da aggiornare, nella maggior parte dei casi, si riempirà in automatico.

\bigskip
\noindent
L’applicazione fornisce nel complesso le funzionalità richieste evidenziate nella fase di progettazione, includendo 
ulteriormente alcune banali operazioni non elencate come la cancellazione di un dipendente o di un paziente, la loro visualizzazione, ecc...

\section{Credenziali del programma}
Le credenziali di default del programma sono:
\begin{packed_itemize}
        \item \textit{Username}: "\texttt{root}" 
        \item \textit{Password}: "\texttt{}"
\end{packed_itemize}
Per cambiarle bisogna modificarle nelle classi:
\begin{packed_itemize}
        \item \texttt{app/src/main/java/utilities/ConnectionProvider.java}
        \item \texttt{app/src/main/java/utilities/TablesInitializer.java}
\end{packed_itemize}
In queste si trovano i campi \textit{username} e \textit{password}, i quali possono essere
modificati. Il campo \textit{dbName} serve a \texttt{TablesInitializer} per creare il database o le tabelle in caso
di assenza di questi elementi, mentre in \texttt{ConnectionProvider} per connettersi al database corretto.
\end{document}